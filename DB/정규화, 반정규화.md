
<br>

### 논리 모델이란?

- 개념 모델을 **상세화**, 대부분의 엔티티와의 관계를 도출하는 단계이다.
- **정규화**를 진행하는 단계


### 논리 모델의 목적?

**중복값을 제거**하여 **이상(Anomaly)현상을 제거**하기 위해 속성간에 **종속관계를 확인(1:N)** 하고 엔터티를 분할한다.

<br>

### 이상(Anomaly)

- 이상이란?
    - **중복된 데이터 때문에** 데이터에 의도하지 않은 현상이 발생되는 것.
    - **삽입 이상, 갱신 이상, 삭제 이상**이 존재한다.
  

### 삽입 이상(Addition Anomaly)

- Relation에서 새로운 인스턴스를 삽입할 때 발생하는 이상 현상.
- 이 경우, **불필요한 정보를 함께 저장**할 수 밖에 없다.

<img width="700" height="300" alt="image" src="https://github.com/user-attachments/assets/5bf7f891-5108-457e-b52f-e907178def8e" />


- 주문 번호와 주문 수량을 추가했지만 기존에 이미 있던 정보인 상품번호,상품명,단가도 저장된 모습. (불필요한 정보)


### 갱신 이상(Update Anomaly)

- Relation에서 속성의 값을 업데이트할 때 발생하는 이상 현상.
- 반복된 데이터 중 **일부만 수정하면 데이터의 불일치가 발생**한다.

<img width="700" height="300" alt="image" src="https://github.com/user-attachments/assets/8f049d37-ed4f-411b-adfd-75bc02959d73" />


- 인스턴스 삽입 시 기존의 상품이라도 상품명, 단가를 모두 추가해 주어야 한다.

### 삭제 이상(Deletion Anomaly)

- Relation에서 인스턴스를 삭제할 때 발생하는 데이터 이상 현상.
- **유용한 정보를 함께 삭제**하지 않고는 어떤 정보를 삭제하는 것이 불가능하다.

<img width="700" height="697" alt="image" src="https://github.com/user-attachments/assets/6bd29f3b-1e8b-4cb4-8b0e-35ebd75d7a10" />


- 상품 번호만 삭제하려 했지만, 해당 상품과 관련된 **다른 유용한 정보까지 함께 삭제**될 수밖에 없는 상황이 발생한다.

### 이러한 이상현상을 해결하기 위해서는?

- Relation을 정규화(테이블 뜯기) 해야한다.
- 1-N 관계를 만들면 된다.

---

## 정규화(Normalization)

### 정규화의 목적?

- **중복 데이터를 제거해 안정성과 확장성을 도모한다.**
    - **안정성**: 함수 종속을 기반으로 데이터의 성격에 맞는 엔터티가 도출되어 모델 구조를 정의할 수 있다.
        - 데이터 간 의존 관계(함수 종속)을 분석하면 어떤 속성이 어떤 속성에 의해 결정되는지 명확해짐.
            
            → 이를 기준으로 엔티티가 분리됨. → 각 테이블은 하나의 주제만 담당하게 되고 데이터 변경 시 
              연쇄 오류가 발생하지 않는다.
            
    - **확장성**: 데이터의 정체성이 그대로 반영되어 업무가 수정되거나 추가 되더라도 엔터티에 반영하기가 수월해 진다.
        - 각 엔터티가 명확한 역할을 가지기 때문에 테이블 전체 구조를 수정할 필요가 없다.

- **함수 종속**
    - **x가 정해지면 y가 따라온다!**
    
<img width="900" height="500" alt="image" src="https://github.com/user-attachments/assets/8fe66911-765e-45fb-98fd-84803fdeb0a6" />

    
- 예시

| 학번 | 이름 | 전공 |
| --- | --- | --- |
| 1001 | 김철수 | 컴공 |
| 1002 | 이영희 | 경영 |
- 여기서 학번 → 이름 , 학번 → 전공 (학번이 같으면 이름과 전공은 무조건 하나로 정해진다.)
- 그래서 이름과 전공은 학번에 종속된다.
<br>

### 정규화의 종류

<img width="900" height="700" alt="image" src="https://github.com/user-attachments/assets/57f4148e-f027-42bb-8bd1-52bc2369255a" />


### 제 1정규형(1NF)

- 모든 속성은 반드시 하나의 값을 가져야 한다.(속성은 원자값을 지녀야 한다.)

<img width="700" height="387" alt="image" src="https://github.com/user-attachments/assets/c143a538-267f-4909-92d2-d9a0af31128a" />


- 원자값으로만 구성된 정규형
<br>

### **제 2정규형(2NF)**

- 기본키가 아닌 모든 속성이 기본키에 **완전 함수 종속**된다.
- **부분 함수 종속을 제거**하고, 모든 속성이 기본키에 **완전 함수 종속**되도록 릴레이션을 분해한다.

- **완전 함수 종속**
    - 어떤 속성이 기본키에 대해 완전히 종속일 때
    - ex) 학생번호+ 강좌이름 둘 다 있어야 수량이 결정되면→  **완전 함수 종속**
    
- **부분 함수 종속**
    - 어떤 속성이 기본키가 아닌 다른 속성에 종속되거나, 기본키가 여러 속성으로 구성되어 있을 경우 기본키를 구성하는 속성 중 일부만 종속될 때.
    - ex) (학생번호, 강좌이름) → 강의실 이지만 실제로는 상품번호만 알면 상품명은 결정될때, 상품명은 전체 기본키가 아니라 기본키의 일부(학생번호)에만 기대고 있음 → **부분 함수 종속**
| 구분 | 의미 |
| --- | --- |
| **완전 함수 종속** | 기본키 전체가 있어야만 결정됨 |
| **부분 함수 종속** | 기본키 일부만으로도 결정됨 |
<img width="700" height="443" alt="image" src="https://github.com/user-attachments/assets/c0a81fab-6c77-4e14-9154-0ee842fe1c31" />



<br>

### 제 3정규형(3NF)

- 릴레이션 제2정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 **이행적 함수 종속이 되지 않으면** 제 3정규형에 속한다.

- **이행적 함수 종속**
    - **기본키가 아닌 속성(비키)이 또 다른 비키를 결정해서, 결과적으로 기본키가 간접적으로 값을 결정하는 구조**를 말한다.
    - ex) 아래 그림에서, 기본키는 학생번호이고 학생번호→ 강좌이름 , 강좌이름 → 수강료 가 된다.
        
             그래서 결과적으로 학생번호 → 수강료가 되는데, 이는 간접적으로 값을 결정하기 때문에 **이행적        함수 종속**이다.
        

- **왜 이행적 함수 종속이 문제가 되는가?**
    - 현재 구조에서는 학생마다 수강료가 반복 저장 → **갱신 이상, 삭제 이상 발생**
        - 그래서 오른쪽 구조로 쪼갠다.

<img width="700" height="470" alt="image" src="https://github.com/user-attachments/assets/34bd323d-21b2-421b-806f-6587d9dd6158" />

<br>

### BCNF 정규화

- 릴레이션의 함수 종속 관계에서 **모든 결정자가 후보키**이면 BCNF에 속한다.
    - 하나의 릴레이션에 여러개의 후보키가 존재할 수도 있는데, 이런 경우는 제3정규형까지 모두 만족하더라도 이상 현상이 발생할 수 있다. 이러한 이상현상을 해결하기 위해 제3정규형보다 좀 더 엄격한 제약조건을 제시한 것이 **BCNF**이다.

<img width="700" height="459" alt="image" src="https://github.com/user-attachments/assets/f1370500-2d98-4724-b4e5-2841a5b94386" />

<br>

### **고급 정규형 (제4정규형, 제5정규형)  (참고)**

- 제 4정규형
    - 릴레이션이 BCNF를 만족하면서, 함수 종속이 아닌 **다치 종속**을 제거해야 만족할 수 있다.

- 제5정규형
    - 릴레이션이 제4정규형을 만족하면서 후보키를 통하지 않는 **조인 종속**을 제거해야 만족할 수 있다.

### 정규화의 장점과 단점

- 장점
    - DB 변경시 이상현상(Anomaly) 제거
    - 저장 공간의 최소화 (용량 감소)
    - 데이터 구조의 안정성 및 무결성 유지
    - 데이터 삽입, 삭제 및 수정 시 테이블의 재구성 필요성 감소
- 단점
    - **릴레이션 간의 JOIN 연산 증가로 인해 응답 시간 저하 → 반정규화 하는 이유**
<br>

## 반정규화(Denormalization)

### 이미 정규화된 테이블을 성능 향상을 위해 의도적으로 다시 합치거나 중복을 허용하는 설계 기법. (의도적으로 정규화 원칙을 위배한다.)

### 반정규화의 장점과 단점

- 장점
    - **데이터를 빠르게 조회**할 수 있음
    - 조인을 제거하기 때문에 검색 시간이 최적화
- 단점
    - 데이터의 삽입, 삭제, 수정 등 갱신 시 비용이 높아짐
    - 데이터간의 일관성이 깨질 수 있음 (서로 다른 데이터가 저장될 수 있음)
    - 많은 저장 공간이 필요함

---

[참고 문서]

https://hongcoding.tistory.com/147

https://seaforest76.tistory.com/28
